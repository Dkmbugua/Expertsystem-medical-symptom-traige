<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Care Assistant</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Leaflet CSS and JS for maps (free, no API key needed) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .floating-input {
            position: relative;
        }
        
        .floating-input input,
        .floating-input select {
            width: 100%;
            padding: 1.25rem 1rem 0.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1.125rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .floating-input input:focus,
        .floating-input select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .floating-input label {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.125rem;
            color: #9ca3af;
            transition: all 0.3s ease;
            pointer-events: none;
            font-weight: 400;
        }
        
        .floating-input input:focus + label,
        .floating-input input:not(:placeholder-shown) + label,
        .floating-input select:focus + label,
        .floating-input.has-value label {
            top: 0.75rem;
            font-size: 0.75rem;
            color: #6366f1;
            font-weight: 500;
        }

        .symptom-pill {
            padding: 1rem 1.5rem;
            border-radius: 50px;
            border: 2px solid #e5e7eb;
            background: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.125rem;
            font-weight: 500;
            color: #374151;
            position: relative;
        }
        
        .symptom-pill:hover {
            border-color: #c7d2fe;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
        }
        
        .symptom-pill.selected {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-color: #6366f1;
            color: white;
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }
        
        .symptom-pill .checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid currentColor;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-center;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }
        
        .symptom-pill.selected .checkmark {
            background: white;
            border-color: white;
        }
        
        .symptom-pill .checkmark svg {
            width: 14px;
            height: 14px;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .symptom-pill.selected .checkmark svg {
            opacity: 1;
            transform: scale(1);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .bg-gradient-soft {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        #map {
            height: 400px;
            width: 100%;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-soft min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function MedicalHelpApp() {
            const [name, setName] = useState('');
            const [age, setAge] = useState('');
            const [gender, setGender] = useState('male');
            const [history, setHistory] = useState('');
            const [locationAddress, setLocationAddress] = useState('');
            const [location, setLocation] = useState({ lat: null, lon: null, formatted: '' });
            const [gettingLocation, setGettingLocation] = useState(false);
            const [selectedSymptoms, setSelectedSymptoms] = useState([]);
            const [allSymptoms, setAllSymptoms] = useState([]);
            const [result, setResult] = useState(null);
            const [nearestPlaces, setNearestPlaces] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            useEffect(() => {
                fetch('/api/symptoms')
                    .then(res => res.json())
                    .then(data => setAllSymptoms(data.symptoms || []))
                    .catch(err => console.error('Error loading symptoms:', err));
            }, []);

            // Filter symptoms based on age
            const getAgeGroupId = (ageValue) => {
                if (!ageValue) return null;
                const a = parseInt(ageValue);
                if (a >= 0 && a <= 10) return 1;
                if (a >= 11 && a <= 20) return 2;
                if (a >= 21 && a <= 30) return 3;
                if (a >= 31 && a <= 40) return 4;
                if (a >= 41 && a <= 50) return 5;
                if (a >= 51 && a <= 60) return 6;
                if (a >= 61 && a <= 70) return 7;
                if (a >= 71 && a <= 80) return 8;
                if (a >= 81 && a <= 90) return 9;
                if (a >= 91) return 10;
                return null;
            };

            // Get filtered symptoms based on age
            const getFilteredSymptoms = () => {
                if (!age) return allSymptoms; // Show all if no age entered
                
                const ageGroupId = getAgeGroupId(age);
                if (!ageGroupId) return allSymptoms;
                
                return allSymptoms.filter(symptom => {
                    // Parse age_groups JSON string
                    try {
                        const ageGroups = JSON.parse(symptom.age_groups || '[]');
                        return ageGroups.length === 0 || ageGroups.includes(ageGroupId);
                    } catch {
                        return true; // Show if can't parse
                    }
                });
            };

            const filteredSymptoms = getFilteredSymptoms();

            const geocodeAddress = async () => {
                if (!locationAddress.trim()) {
                    setError('Please enter a location');
                    return;
                }

                setGettingLocation(true);
                setError('');

                try {
                    const response = await fetch('/api/geocode', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ address: locationAddress })
                    });

                    if (!response.ok) {
                        throw new Error('Location not found');
                    }

                    const data = await response.json();
                    setLocation({
                        lat: data.lat,
                        lon: data.lon,
                        formatted: data.formatted_address
                    });
                } catch (err) {
                    setError('Could not find location: ' + err.message);
                } finally {
                    setGettingLocation(false);
                }
            };

            const getMyLocation = () => {
                setGettingLocation(true);
                setError('');
                
                if (!navigator.geolocation) {
                    setError('Location not supported by your browser');
                    setGettingLocation(false);
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        // Reverse geocode to get address
                        try {
                            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                            const data = await response.json();
                            setLocationAddress(data.display_name || '');
                        } catch (e) {
                            console.error('Reverse geocoding failed:', e);
                        }
                        
                        setLocation({ 
                            lat, 
                            lon, 
                            formatted: `${lat.toFixed(4)}, ${lon.toFixed(4)}` 
                        });
                        setGettingLocation(false);
                    },
                    (error) => {
                        setError('Could not get location. Please enter manually or allow location access.');
                        setGettingLocation(false);
                    }
                );
            };

            const toggleSymptom = (symptomName) => {
                if (selectedSymptoms.includes(symptomName)) {
                    setSelectedSymptoms(selectedSymptoms.filter(s => s !== symptomName));
                } else {
                    setSelectedSymptoms([...selectedSymptoms, symptomName]);
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                
                if (!name || !age) {
                    setError('Please enter your name and age');
                    return;
                }
                
                if (selectedSymptoms.length === 0) {
                    setError('Please select at least one symptom');
                    return;
                }

                if (!location.lat || !location.lon) {
                    setError('Please provide your location to find nearest hospital/chemist');
                    return;
                }

                setLoading(true);
                setError('');

                try {
                    // First, get triage recommendation from expert system
                    // The expert system will determine transport mode based on symptoms!
                    const triageResponse = await fetch('/triage', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name,
                            age: parseInt(age),
                            gender,
                            symptoms: selectedSymptoms.join(', '),
                            history: history || 'none',
                            mode_of_arrival: 'walk-in'  // Default - expert system will override
                        })
                    });

                    if (!triageResponse.ok) {
                        throw new Error('Could not analyze symptoms');
                    }

                    const triageData = await triageResponse.json();
                    setResult(triageData);

                    // Find nearest hospitals from our database
                    const hospitalResponse = await fetch('/api/nearest-hospitals', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            latitude: location.lat,
                            longitude: location.lon,
                            limit: 3
                        })
                    });

                    if (hospitalResponse.ok) {
                        const hospitals = await hospitalResponse.json();
                        setNearestPlaces(hospitals);
                    }
                } catch (err) {
                    setError('Error: ' + err.message);
                } finally {
                    setLoading(false);
                }
            };

            const startOver = () => {
                setName('');
                setAge('');
                setGender('male');
                setHistory('');
                setLocationAddress('');
                setLocation({ lat: null, lon: null, formatted: '' });
                setSelectedSymptoms([]);
                setResult(null);
                setNearestPlaces([]);
                setError('');
            };

            // Render map with markers after component mounts (MUST be at top level - React Hook Rules!)
            React.useEffect(() => {
                if (result && nearestPlaces.length > 0 && location.lat && location.lon) {
                        // Wait for DOM to be ready
                        setTimeout(() => {
                            const mapContainer = document.getElementById('map');
                            if (mapContainer && !mapContainer._leaflet_id) {
                                // Initialize map centered on user location
                                const map = L.map('map').setView([location.lat, location.lon], 13);
                                
                                // Add OpenStreetMap tiles (free, no API key)
                                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                    attribution: '¬© OpenStreetMap contributors',
                                    maxZoom: 19
                                }).addTo(map);
                                
                                // Add user location marker
                                L.marker([location.lat, location.lon], {
                                    icon: L.divIcon({
                                        className: 'custom-div-icon',
                                        html: "<div style='background-color:#4299e1;width:30px;height:30px;border-radius:50%;border:3px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;'><span style='color:white;font-size:18px;'>üìç</span></div>",
                                        iconSize: [30, 30],
                                        iconAnchor: [15, 15]
                                    })
                                }).addTo(map).bindPopup('<b>Your Location</b>');
                                
                                // Add hospital markers
                                nearestPlaces.forEach((hospital, idx) => {
                                    if (hospital.latitude && hospital.longitude) {
                                        const directionsUrl = `https://www.google.com/maps/dir/?api=1&origin=${location.lat},${location.lon}&destination=${hospital.latitude},${hospital.longitude}`;
                                        const popupContent = `
                                            <div style="min-width:200px;">
                                                <h3 style="margin:0 0 8px 0;font-weight:bold;color:#1f2937;">${hospital.name}</h3>
                                                ${hospital.address ? `<p style="margin:4px 0;font-size:12px;color:#6b7280;">üìç ${hospital.address}</p>` : ''}
                                                <p style="margin:4px 0;font-weight:600;color:#374151;">üìè ${hospital.distance_km.toFixed(1)} km away</p>
                                                ${hospital.contact ? `<p style="margin:4px 0;font-size:13px;color:#059669;">üìû ${hospital.contact}</p>` : ''}
                                                <a href="${directionsUrl}" target="_blank" rel="noopener noreferrer" 
                                                   style="display:inline-block;margin-top:8px;padding:8px 16px;background:#2563eb;color:white;text-decoration:none;border-radius:8px;font-weight:600;font-size:13px;">
                                                    üó∫Ô∏è Get Directions
                                                </a>
                                            </div>
                                        `;
                                        
                                        L.marker([hospital.latitude, hospital.longitude], {
                                            icon: L.divIcon({
                                                className: 'custom-div-icon',
                                                html: "<div style='background-color:#dc2626;width:36px;height:36px;border-radius:50%;border:3px solid white;box-shadow:0 2px 8px rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;'><span style='font-size:20px;'>üè•</span></div>",
                                                iconSize: [36, 36],
                                                iconAnchor: [18, 18]
                                            })
                                        }).addTo(map).bindPopup(popupContent);
                                    }
                                });
                                
                                // Fit map bounds to show all markers
                                const bounds = L.latLngBounds(
                                    [location.lat, location.lon],
                                    ...nearestPlaces.filter(h => h.latitude && h.longitude).map(h => [h.latitude, h.longitude])
                                );
                                map.fitBounds(bounds, { padding: [50, 50] });
                            }
                        }, 100);
                    }
                }, [nearestPlaces, result, location]);
                
            // Calculate ETA based on transport mode and distance
            const calculateETA = (distanceKm, speedKmH) => {
                if (!speedKmH || speedKmH === 0) return null;
                const hours = distanceKm / speedKmH;
                const minutes = Math.ceil(hours * 60);
                if (minutes < 60) return `${minutes} min`;
                const hrs = Math.floor(minutes / 60);
                const mins = minutes % 60;
                return `${hrs}h ${mins}min`;
            };

            // Process result data if available
            if (result) {
                const isEmergency = result.triage_level === 'RED';
                const isUrgent = result.triage_level === 'YELLOW';
                const isMild = result.triage_level === 'GREEN';
                
                // Get transport recommendation from backend
                const transport = result.transport || 'none';
                const getTransportDisplay = () => {
                    switch(transport) {
                        case 'ambulance':
                            return { icon: 'üöë', text: 'Ambulance Required', emoji: 'üìû', phone: '999', speed: 60 };
                        case 'matatu':
                            return { icon: 'üöï', text: 'Matatu, Taxi, or Uber', emoji: 'üöó', speed: 40 };
                        case 'chemist':
                            return { icon: 'üíä', text: 'Visit Pharmacy/Chemist', emoji: 'üè™', speed: 30 };
                        default:
                            return { icon: '‚úÖ', text: 'Rest at home', emoji: 'üè†', speed: 0 };
                    }
                };
                const transportInfo = getTransportDisplay();
                
                // Extract recommendation from rationale for better display
                const recommendation = result.rationale || 'Please consult a healthcare professional.';

                return (
                    <div className="min-h-screen p-6 md:p-12 flex items-center justify-center">
                        <div className="max-w-2xl w-full space-y-6 fade-in-up">
                            {isEmergency && (
                                <div className="glass-effect rounded-3xl p-10 text-center shadow-2xl border border-red-200">
                                    <div className="text-8xl mb-6">üö®</div>
                                    <h1 className="text-4xl font-bold text-red-600 mb-4">Emergency</h1>
                                    
                                    {/* RECOMMENDATION SECTION - Clear and Prominent */}
                                    <div className="bg-white border-2 border-red-400 rounded-2xl p-6 mb-6">
                                        <h2 className="text-xl font-bold text-red-800 mb-3 flex items-center justify-center gap-2">
                                            üìã Expert System Recommendation
                                        </h2>
                                        <p className="text-lg text-gray-800 leading-relaxed">{recommendation}</p>
                                    </div>
                                    
                                    <div className="bg-red-50 border-2 border-red-300 rounded-2xl p-6 mb-6">
                                        <div className="text-6xl mb-4">{transportInfo.icon}</div>
                                        <p className="text-2xl font-bold text-red-900 mb-2">{transportInfo.text}</p>
                                        {transportInfo.phone && (
                                            <p className="text-5xl font-bold text-red-600">{transportInfo.emoji} {transportInfo.phone}</p>
                                        )}
                                    </div>
                                    
                                    {nearestPlaces.length > 0 && (
                                        <div className="bg-white border-2 border-red-200 rounded-2xl p-6 mb-6">
                                            <h3 className="text-xl font-bold text-gray-900 mb-4">üè• Nearest Hospitals</h3>
                                            
                                            {/* Interactive Map */}
                                            <div id="map" className="mb-4"></div>
                                            
                                            <div className="space-y-3">
                                                {nearestPlaces.map((hospital, idx) => {
                                                    const directionsUrl = `https://www.google.com/maps/dir/?api=1&origin=${location.lat},${location.lon}&destination=${hospital.latitude},${hospital.longitude}`;
                                                    return (
                                                        <div key={idx} className="bg-red-50 p-4 rounded-xl text-left border-l-4 border-red-500">
                                                            <p className="font-bold text-gray-900 mb-1">{hospital.name}</p>
                                                            {hospital.address && (
                                                                <p className="text-xs text-gray-500 mb-1">üìç {hospital.address}</p>
                                                            )}
                                                            <p className="text-sm text-gray-700 font-semibold mb-1">
                                                                üìè {hospital.distance_text || `${hospital.distance_km.toFixed(1)} km`}
                                                                {hospital.duration_text && <span className="ml-2">‚Ä¢ ‚è±Ô∏è {hospital.duration_text}</span>}
                                                            </p>
                                                            {hospital.rating && (
                                                                <p className="text-sm text-gray-600 mb-2">‚≠ê {hospital.rating.toFixed(1)}</p>
                                                            )}
                                                            {hospital.contact && (
                                                                <p className="text-sm text-green-700 font-semibold mb-2">üìû {hospital.contact}</p>
                                                            )}
                                                            <a 
                                                                href={directionsUrl}
                                                                target="_blank"
                                                                rel="noopener noreferrer"
                                                                className="inline-block px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-all"
                                                            >
                                                                üó∫Ô∏è Get Directions
                                                            </a>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    )}
                                    
                                    <button 
                                        onClick={startOver}
                                        className="px-8 py-4 bg-white border-2 border-gray-300 rounded-full text-lg font-semibold text-gray-700 hover:bg-gray-50 transition-all"
                                    >
                                        Check Another Patient
                                    </button>
                                </div>
                            )}

                            {isUrgent && (
                                <div className="glass-effect rounded-3xl p-10 text-center shadow-2xl border border-yellow-200">
                                    <div className="text-8xl mb-6">‚ö†Ô∏è</div>
                                    <h1 className="text-4xl font-bold text-yellow-600 mb-4">Urgent Care Needed</h1>
                                    
                                    {/* RECOMMENDATION SECTION - Clear and Prominent */}
                                    <div className="bg-white border-2 border-yellow-400 rounded-2xl p-6 mb-6">
                                        <h2 className="text-xl font-bold text-yellow-800 mb-3 flex items-center justify-center gap-2">
                                            üìã Expert System Recommendation
                                        </h2>
                                        <p className="text-lg text-gray-800 leading-relaxed">{recommendation}</p>
                                    </div>
                                    
                                    <div className="bg-yellow-50 border-2 border-yellow-300 rounded-2xl p-6 mb-6">
                                        <div className="text-6xl mb-4">{transportInfo.icon}</div>
                                        <p className="text-xl font-semibold text-yellow-900 mb-2">Recommended transport:</p>
                                        <p className="text-2xl font-bold text-yellow-800">{transportInfo.text}</p>
                                    </div>
                                    
                                    {nearestPlaces.length > 0 && (
                                        <div className="bg-white border-2 border-yellow-200 rounded-2xl p-6 mb-6">
                                            <h3 className="text-xl font-bold text-gray-900 mb-4">üè• Nearest Hospitals</h3>
                                            
                                            {/* Interactive Map */}
                                            <div id="map" className="mb-4"></div>
                                            
                                            <div className="space-y-3">
                                                {nearestPlaces.map((hospital, idx) => {
                                                    const eta = calculateETA(hospital.distance_km, transportInfo.speed);
                                                    const directionsUrl = `https://www.google.com/maps/dir/?api=1&origin=${location.lat},${location.lon}&destination=${hospital.latitude},${hospital.longitude}`;
                                                    return (
                                                        <div key={idx} className="bg-yellow-50 p-4 rounded-xl text-left border-l-4 border-yellow-500">
                                                            <p className="font-bold text-gray-900 mb-1">{hospital.name}</p>
                                                            <p className="text-sm text-gray-600 mb-1">
                                                                üìç {hospital.distance_km.toFixed(1)} km away
                                                                {eta && <span className="ml-2">‚Ä¢ ‚è±Ô∏è ETA: <strong>{eta}</strong></span>}
                                                            </p>
                                                            {hospital.contact && (
                                                                <p className="text-sm text-yellow-700 font-semibold mb-2">üìû {hospital.contact}</p>
                                                            )}
                                                            <a 
                                                                href={directionsUrl}
                                                                target="_blank"
                                                                rel="noopener noreferrer"
                                                                className="inline-block px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-all"
                                                            >
                                                                üó∫Ô∏è Get Directions
                                                            </a>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    )}
                                    
                                    <button 
                                        onClick={startOver}
                                        className="px-8 py-4 bg-white border-2 border-gray-300 rounded-full text-lg font-semibold text-gray-700 hover:bg-gray-50 transition-all"
                                    >
                                        Check Another Patient
                                    </button>
                                </div>
                            )}

                            {isMild && (
                                <div className="glass-effect rounded-3xl p-10 text-center shadow-2xl border border-green-200">
                                    <div className="text-8xl mb-6">‚úÖ</div>
                                    <h1 className="text-4xl font-bold text-green-600 mb-4">Self-Care Recommended</h1>
                                    
                                    {/* RECOMMENDATION SECTION - Clear and Prominent */}
                                    <div className="bg-white border-2 border-green-400 rounded-2xl p-6 mb-6">
                                        <h2 className="text-xl font-bold text-green-800 mb-3 flex items-center justify-center gap-2">
                                            üìã Expert System Recommendation
                                        </h2>
                                        <p className="text-lg text-gray-800 leading-relaxed">{recommendation}</p>
                                    </div>
                                    
                                    <div className="bg-green-50 border-2 border-green-300 rounded-2xl p-6 mb-6">
                                        <div className="text-6xl mb-4">{transportInfo.icon}</div>
                                        <p className="text-xl font-semibold text-green-900 mb-2">Recommended action:</p>
                                        <p className="text-2xl font-bold text-green-800 mb-4">{transportInfo.text}</p>
                                        <ul className="text-left text-gray-700 space-y-2 max-w-sm mx-auto">
                                            <li className="flex items-center gap-2">
                                                <span className="text-green-600">‚úì</span> Rest at home
                                            </li>
                                            <li className="flex items-center gap-2">
                                                <span className="text-green-600">‚úì</span> Drink plenty of water
                                            </li>
                                            <li className="flex items-center gap-2">
                                                <span className="text-green-600">‚úì</span> Monitor symptoms
                                            </li>
                                            <li className="flex items-center gap-2">
                                                <span className="text-green-600">‚úì</span> See doctor if symptoms worsen
                                            </li>
                                        </ul>
                                    </div>
                                    
                                    {nearestPlaces.length > 0 && (
                                        <div className="bg-white border-2 border-green-200 rounded-2xl p-6 mb-6">
                                            <h3 className="text-xl font-bold text-gray-900 mb-4">üíä Nearest Chemists/Hospitals</h3>
                                            <p className="text-sm text-gray-600 mb-3">You can get medicine from:</p>
                                            
                                            {/* Interactive Map */}
                                            <div id="map" className="mb-4"></div>
                                            
                                            <div className="space-y-3">
                                                {nearestPlaces.map((place, idx) => {
                                                    const eta = calculateETA(place.distance_km, transportInfo.speed || 30);
                                                    const directionsUrl = `https://www.google.com/maps/dir/?api=1&origin=${location.lat},${location.lon}&destination=${place.latitude},${place.longitude}`;
                                                    return (
                                                        <div key={idx} className="bg-green-50 p-4 rounded-xl text-left border-l-4 border-green-500">
                                                            <p className="font-bold text-gray-900 mb-1">{place.name}</p>
                                                            <p className="text-sm text-gray-600 mb-1">
                                                                üìç {place.distance_km.toFixed(1)} km away
                                                                {eta && <span className="ml-2">‚Ä¢ üö∂ Walk/Drive: <strong>{eta}</strong></span>}
                                                            </p>
                                                            {place.contact && (
                                                                <p className="text-sm text-green-700 font-semibold mb-2">üìû {place.contact}</p>
                                                            )}
                                                            <a 
                                                                href={directionsUrl}
                                                                target="_blank"
                                                                rel="noopener noreferrer"
                                                                className="inline-block px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-all"
                                                            >
                                                                üó∫Ô∏è Get Directions
                                                            </a>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    )}
                                    
                                    <button 
                                        onClick={startOver}
                                        className="px-8 py-4 bg-white border-2 border-gray-300 rounded-full text-lg font-semibold text-gray-700 hover:bg-gray-50 transition-all"
                                    >
                                        Check Another Patient
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen py-8 px-4 md:px-8">
                    <div className="max-w-5xl mx-auto">
                        <div className="text-center mb-12 fade-in-up">
                            <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl mb-6 shadow-lg">
                                <svg className="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                </svg>
                            </div>
                            <h1 className="text-5xl font-bold text-gray-900 mb-3">Medical Care Assistant</h1>
                            <p className="text-xl text-gray-600 font-light">Quick symptom evaluation to guide your next steps</p>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-8">
                            <div className="glass-effect rounded-3xl p-8 md:p-10 shadow-xl border border-gray-200">
                                <div className="flex items-center gap-3 mb-8">
                                    <div className="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center">
                                        <span className="text-indigo-600 font-bold">1</span>
                                    </div>
                                    <h2 className="text-2xl font-semibold text-gray-900">Your Information</h2>
                                </div>
                                
                                <div className="grid md:grid-cols-3 gap-6 mb-6">
                                    <div className={`floating-input ${name ? 'has-value' : ''}`}>
                                        <input
                                            type="text"
                                            placeholder=" "
                                            value={name}
                                            onChange={(e) => setName(e.target.value)}
                                            required
                                        />
                                        <label>Full Name</label>
                                    </div>
                                    
                                    <div className={`floating-input ${age ? 'has-value' : ''}`}>
                                        <input
                                            type="number"
                                            placeholder=" "
                                            value={age}
                                            onChange={(e) => setAge(e.target.value)}
                                            required
                                        />
                                        <label>Age</label>
                                    </div>
                                    
                                    <div className="floating-input has-value">
                                        <select
                                            value={gender}
                                            onChange={(e) => setGender(e.target.value)}
                                        >
                                            <option value="male">Male</option>
                                            <option value="female">Female</option>
                                        </select>
                                        <label>Gender</label>
                                    </div>
                                </div>

                                <div className="grid md:grid-cols-1 gap-6">
                                    <div className={`floating-input ${history ? 'has-value' : ''}`}>
                                        <input
                                            type="text"
                                            placeholder=" "
                                            value={history}
                                            onChange={(e) => setHistory(e.target.value)}
                                        />
                                        <label>Medical History (diabetes, hypertension, etc.)</label>
                                    </div>
                                </div>
                            </div>

                            <div className="glass-effect rounded-3xl p-8 md:p-10 shadow-xl border border-gray-200">
                                <div className="flex items-center gap-3 mb-6">
                                    <div className="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center">
                                        <span className="text-indigo-600 font-bold">2</span>
                                    </div>
                                    <h2 className="text-2xl font-semibold text-gray-900">Your Location</h2>
                                </div>
                                
                                <p className="text-gray-600 mb-6">Enter your address (e.g., "Ngong Road, Nairobi") or use GPS</p>

                                <div className="space-y-4">
                                    <div className="flex gap-2">
                                        <div className={`floating-input flex-1 ${locationAddress ? 'has-value' : ''}`}>
                                            <input
                                                type="text"
                                                placeholder=" "
                                                value={locationAddress}
                                                onChange={(e) => setLocationAddress(e.target.value)}
                                                disabled={gettingLocation}
                                                onKeyPress={(e) => e.key === 'Enter' && geocodeAddress()}
                                            />
                                            <label>Address (e.g., Nairobi, Kenya)</label>
                                        </div>
                                        
                                        <button
                                            type="button"
                                            onClick={geocodeAddress}
                                            disabled={gettingLocation || !locationAddress.trim()}
                                            className="px-6 py-4 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                                        >
                                            üîç Find
                                        </button>
                                    </div>

                                    <div className="flex items-center gap-3">
                                        <div className="flex-1 border-t border-gray-300"></div>
                                        <span className="text-gray-500 text-sm">OR</span>
                                        <div className="flex-1 border-t border-gray-300"></div>
                                    </div>
                                    
                                    <button
                                        type="button"
                                        onClick={getMyLocation}
                                        disabled={gettingLocation}
                                        className="w-full px-6 py-4 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2"
                                    >
                                        {gettingLocation ? (
                                            <>
                                                <svg className="animate-spin h-5 w-5" fill="none" viewBox="0 0 24 24">
                                                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                </svg>
                                                Getting your GPS location...
                                            </>
                                        ) : (
                                            <>
                                                üìç Use My Current GPS Location
                                            </>
                                        )}
                                    </button>
                                </div>

                                {location.lat && location.lon && (
                                    <div className="mt-4 p-4 bg-green-50 border-2 border-green-300 rounded-xl">
                                        <p className="text-sm font-semibold text-green-900 mb-1">‚úì Location confirmed:</p>
                                        <p className="text-sm text-green-700">{location.formatted || `${location.lat.toFixed(4)}, ${location.lon.toFixed(4)}`}</p>
                                    </div>
                                )}
                            </div>

                            <div className="glass-effect rounded-3xl p-8 md:p-10 shadow-xl border border-gray-200">
                                <div className="flex items-center gap-3 mb-6">
                                    <div className="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center">
                                        <span className="text-indigo-600 font-bold">3</span>
                                    </div>
                                    <h2 className="text-2xl font-semibold text-gray-900">Select Your Symptoms</h2>
                                </div>
                                
                                <p className="text-gray-600 mb-4">Click all that apply. You can select multiple symptoms.</p>

                                {age && (
                                    <div className="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-xl">
                                        <p className="text-sm text-blue-800">
                                            <span className="font-semibold">üéØ Age-filtered symptoms:</span> Showing {filteredSymptoms.length} symptoms relevant for age {age}
                                        </p>
                                    </div>
                                )}

                                {selectedSymptoms.length > 0 && (
                                    <div className="mb-6 p-4 bg-indigo-50 border-2 border-indigo-200 rounded-2xl">
                                        <p className="text-sm font-semibold text-indigo-900 mb-2">Selected symptoms:</p>
                                        <p className="text-lg text-indigo-700">
                                            {selectedSymptoms.map(s => s.replace(/-/g, ' ')).join(', ')}
                                        </p>
                                    </div>
                                )}

                                {filteredSymptoms.length === 0 && (
                                    <div className="p-6 bg-yellow-50 border-2 border-yellow-200 rounded-xl text-center">
                                        <p className="text-yellow-800">No symptoms available for this age group. Please check your age input.</p>
                                    </div>
                                )}

                                <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {filteredSymptoms.map((symptom) => {
                                        const isSelected = selectedSymptoms.includes(symptom.name);
                                        return (
                                            <button
                                                key={symptom.id}
                                                type="button"
                                                className={`symptom-pill ${isSelected ? 'selected' : ''}`}
                                                onClick={() => toggleSymptom(symptom.name)}
                                            >
                                                <div className="checkmark">
                                                    {isSelected && (
                                                        <svg fill="none" stroke="#6366f1" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                                                        </svg>
                                                    )}
                                                </div>
                                                <span className="relative z-10">
                                                    {symptom.name.replace(/-/g, ' ').split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')}
                                                </span>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>

                            <div className="text-center pt-4">
                                <button
                                    type="submit"
                                    disabled={loading || selectedSymptoms.length === 0}
                                    className="px-12 py-5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-full text-xl font-semibold hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed shadow-xl hover:shadow-2xl transform hover:scale-105 transition-all duration-300"
                                >
                                    {loading ? (
                                        <span className="flex items-center gap-3">
                                            <svg className="animate-spin h-6 w-6" fill="none" viewBox="0 0 24 24">
                                                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                            </svg>
                                            Analyzing...
                                        </span>
                                    ) : (
                                        'Get Care Recommendation'
                                    )}
                                </button>
                            </div>

                            {error && (
                                <div className="glass-effect border-2 border-red-300 text-red-800 p-5 rounded-2xl text-center font-medium shadow-lg">
                                    ‚ö†Ô∏è {error}
                                </div>
                            )}
                        </form>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<MedicalHelpApp />, document.getElementById('root'));
    </script>
</body>
</html>
